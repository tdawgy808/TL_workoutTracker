<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>CoachTommy — Mobile Tracker</title>
<style>
  :root{--bg:#0f1115;--card:#171a21;--muted:#9aa4b2;--text:#e8edf2;--stroke:#2a3446;}
  *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
  header{position:sticky;top:0;z-index:9;background:#12151d;border-bottom:1px solid var(--stroke);padding:10px 12px;display:flex;justify-content:space-between;align-items:center}
  h1{font-size:18px;margin:0} .tabs button{all:unset;font-size:14px;padding:8px 10px;border:1px solid var(--stroke);border-radius:10px;margin-left:6px;color:#cbd5e1}
  .tabs button.active{color:#7dd3fc;border-color:#7dd3fc}
  .wrap{max-width:680px;margin:0 auto;padding:12px}
  .card{background:var(--card);border:1px solid var(--stroke);border-radius:12px;padding:12px;margin:10px 0}
  label{font-size:12px;color:var(--muted);display:block;margin:6px 0 2px}
  input,select{width:100%;padding:10px;border-radius:10px;border:1px solid var(--stroke);background:#0b0e14;color:var(--text);font-size:16px}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:8px}
  .btn{width:100%;padding:12px;border-radius:10px;border:1px solid var(--stroke);background:#0e1420;color:var(--text);margin-top:10px}
  .muted{color:var(--muted);font-size:12px}
  table{width:100%;border-collapse:collapse;font-size:13px} th,td{padding:8px;border-bottom:1px solid var(--stroke);text-align:left}
</style>
</head>
<body>
<header>
  <h1>CoachTommy — Mobile</h1>
  <div class="tabs">
    <button class="active" data-tab="quick">Quick Log</button>
    <button data-tab="hydrate">Hydrate</button>
    <button data-tab="weigh">Weigh-in</button>
    <button data-tab="data">Data</button>
  </div>
</header>

<div class="wrap">
  <!-- Quick Log -->
  <section id="quick" class="card tab active">
    <h3 style="margin:0 0 6px">Quick Set</h3>
    <label>Exercise</label>
    <select id="ex">
      <option>Back Squat</option>
      <option>Romanian Deadlift</option>
      <option>Walking Lunge</option>
      <option>Leg Press</option>
      <option>Bulgarian Split Squat</option>
      <option>Calf Raise</option>
      <option>Deadlift</option>
      <option>Pull-up</option>
      <option>Barbell Row</option>
      <option>Face Pull</option>
      <option>Barbell Bench Press</option>
      <option>Incline Dumbbell Press</option>
      <option>Overhead Press</option>
      <option>Dumbbell Lateral Raise</option>
      <option>Triceps Rope Pushdown</option>
      <option>Push-up</option>
      <option>Barbell Curl</option>
      <option>Hammer Curl</option>
      <option>Goblet Squat</option>
      <option>Kettlebell Swing</option>
      <option>Inverted Row</option>
      <option>Plank</option>
      <option>Hanging Leg Raise</option>
      <option>Sled Push</option>
      <option>Farmer Carry</option>
    </select>
    <div class="row">
      <div><label>Weight (lb)</label><input id="w" type="number" inputmode="decimal"></div>
      <div><label>Reps</label><input id="r" type="number" inputmode="numeric"></div>
    </div>
    <div class="row">
      <div><label>RPE (1–10)</label><input id="rpe" type="number" step="0.5" inputmode="decimal"></div>
      <div><label>Notes</label><input id="note" placeholder="cues / tempo"></div>
    </div>
    <button class="btn" onclick="addSet()">Save Set</button>
    <div class="muted" id="statusSet" style="margin-top:6px"></div>
  </section>

  <!-- Hydration -->
  <section id="hydrate" class="card tab" style="display:none">
    <h3 style="margin:0 0 6px">Hydration & Creatine</h3>
    <div class="row">
      <div><label>Water (oz)</label><input id="h_oz" type="number" inputmode="decimal"></div>
      <div><label>Creatine (g)</label><input id="h_cr" type="number" inputmode="decimal" value="15"></div>
    </div>
    <label>Notes</label><input id="h_note">
    <button class="btn" onclick="addHydro()">Save Hydration</button>
    <div class="muted" id="statusHydro" style="margin-top:6px"></div>
  </section>

  <!-- Weigh-in -->
  <section id="weigh" class="card tab" style="display:none">
    <h3 style="margin:0 0 6px">Weigh-in</h3>
    <div class="row">
      <div><label>Weight (lb)</label><input id="wi_w" type="number" inputmode="decimal"></div>
      <div><label>Body Fat %</label><input id="wi_bf" type="number" inputmode="decimal"></div>
    </div>
    <label>Notes</label><input id="wi_note">
    <button class="btn" onclick="addWeigh()">Save Weigh-in</button>
    <div class="muted" id="statusWeigh" style="margin-top:6px"></div>
  </section>

  <!-- Data -->
  <section id="data" class="card tab" style="display:none">
    <h3 style="margin:0 0 6px">Recent</h3>
    <table id="tSets"><thead><tr><th>Date</th><th>Exercise</th><th>W</th><th>R</th><th>RPE</th></tr></thead><tbody></tbody></table>
    <div style="height:8px"></div>
    <h3 style="margin:10px 0 6px">Import / Export</h3>
    <div class="row">
      <button class="btn" onclick="exportJSON()">Export JSON</button>
      <input type="file" id="importJson" accept=".json">
    </div>
    <button class="btn" onclick="importJSON()">Import JSON</button>

    <div class="card" style="margin:12px -12px -12px -12px;border:none;border-top:1px solid var(--stroke)">
      <h3 style="margin:10px 0 6px">Import Fitbod CSV</h3>
      <input type="file" id="fitbodCsv" accept=".csv">
      <button class="btn" onclick="importFitbod()">Import CSV</button>
      <div class="muted" id="fitStatus" style="margin-top:6px"></div>
    </div>
  </section>
</div>

<script>
// Tabs
document.querySelectorAll('.tabs button').forEach(b=>b.addEventListener('click', ()=>{
  document.querySelectorAll('.tabs button').forEach(x=>x.classList.remove('active')); b.classList.add('active');
  document.querySelectorAll('.tab').forEach(s=>s.style.display='none'); document.getElementById(b.dataset.tab).style.display='block';
}));

// Store
let store = JSON.parse(localStorage.getItem('ct_mobile') || '{"sets":[],"hydration":[],"weighins":[]}');
function save(){ localStorage.setItem('ct_mobile', JSON.stringify(store)); render(); }

// Adders
function addSet(){
  const ex=document.getElementById('ex').value;
  const w=parseFloat(document.getElementById('w').value||0);
  const r=parseInt(document.getElementById('r').value||0);
  const rpe=parseFloat(document.getElementById('rpe').value||''); const rp = isNaN(rpe)? null:rpe;
  const note=document.getElementById('note').value||'';
  if(!ex||!w||!r){ document.getElementById('statusSet').textContent='Enter exercise, weight, and reps.'; return; }
  store.sets.push({dt:new Date().toISOString(),ex,weight:w,reps:r,rpe:rp,note});
  ['w','r','rpe','note'].forEach(id=>document.getElementById(id).value='');
  document.getElementById('statusSet').textContent='Saved ✓';
  save();
}

function addHydro(){
  const oz=parseFloat(document.getElementById('h_oz').value||0);
  const g =parseFloat(document.getElementById('h_cr').value||0);
  const note=document.getElementById('h_note').value||'';
  store.hydration.push({dt:new Date().toISOString(),oz,g,note});
  ['h_oz','h_cr','h_note'].forEach(id=>document.getElementById(id).value='');
  document.getElementById('statusHydro').textContent='Saved ✓';
  save();
}

function addWeigh(){
  const w=parseFloat(document.getElementById('wi_w').value||0);
  const bf=parseFloat(document.getElementById('wi_bf').value||'');
  const note=document.getElementById('wi_note').value||'';
  if(!w){ document.getElementById('statusWeigh').textContent='Enter weight.'; return; }
  store.weighins.push({dt:new Date().toISOString(),weight:w,bodyFat:isNaN(bf)?null:bf,note});
  ['wi_w','wi_bf','wi_note'].forEach(id=>document.getElementById(id).value='');
  document.getElementById('statusWeigh').textContent='Saved ✓';
  save();
}

// Render
function render(){
  const tbody=document.querySelector('#tSets tbody');
  tbody.innerHTML = store.sets.slice().sort((a,b)=>new Date(b.dt)-new Date(a.dt)).slice(0,30).map(s=>
    '<tr><td>'+new Date(s.dt).toLocaleString()+'</td><td>'+s.ex+'</td><td>'+s.weight+'</td><td>'+s.reps+'</td><td>'+(s.rpe??'')+'</td></tr>'
  ).join('');
}

// Backup
function exportJSON(){
  const blob=new Blob([JSON.stringify(store,null,2)],{type:'application/json'});
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='coach_tommy_mobile.json'; a.click();
}
function importJSON(){
  const f=document.getElementById('importJson').files[0]; if(!f) return alert('Pick a JSON file first');
  const r=new FileReader(); r.onload=e=>{ try{ store=JSON.parse(e.target.result); save(); alert('Imported!'); }catch(err){ alert('Invalid JSON'); } }; r.readAsText(f);
}

// CSV (Fitbod)
function parseCSV(text){
  const lines=text.split(/\r?\n/).filter(l=>l.trim().length), out=[];
  for(const line of lines){ let row=[],cur='',q=false;
    for(let i=0;i<line.length;i++){ const ch=line[i];
      if(ch=='"'){ if(q&&line[i+1]=='"'){cur+='"';i++;} else q=!q; }
      else if(ch==','&&!q){ row.push(cur); cur=''; }
      else cur+=ch;
    } row.push(cur); out.push(row.map(x=>x.trim()));
  } return out;
}
function importFitbod(){
  const f=document.getElementById('fitbodCsv').files[0]; if(!f) return alert('Pick a CSV first');
  const r=new FileReader();
  r.onload=e=>{ try{
    const rows=parseCSV(e.target.result); if(!rows.length) throw new Error('Empty CSV');
    const h=rows[0].map(x=>x.toLowerCase());
    const di=h.indexOf('date'), ei=h.indexOf('exercise'), ri=h.indexOf('reps'); let wi=h.indexOf('weight(kg)'); if(wi==-1) wi=h.indexOf('weight');
    if(di==-1||ei==-1||ri==-1||wi==-1) throw new Error('Missing columns');
    let added=0, skipped=0;
    const keyset=new Set(store.sets.map(s=>[s.dt.slice(0,19),s.ex,Math.round(s.weight),s.reps].join('|')));
    for(let i=1;i<rows.length;i++){ const row=rows[i]; if(!row||row.length<h.length) continue;
      const d=new Date(row[di]); if(isNaN(+d)) continue; const ex=row[ei]; const reps=parseInt(row[ri]||'0'); const wkg=parseFloat(row[wi]||'0'); const wlb=Math.round((wkg*2.20462)*10)/10;
      const key=[d.toISOString().slice(0,19),ex,Math.round(wlb),reps].join('|'); if(keyset.has(key)){skipped++; continue;}
      keyset.add(key); store.sets.push({dt:d.toISOString(),ex,weight:wlb,reps,rpe:null,note:'Fitbod import'}); added++;
    }
    save(); document.getElementById('fitStatus').textContent = 'Imported '+added+' sets ('+skipped+' skipped).';
  }catch(err){ document.getElementById('fitStatus').textContent='Import error: '+err.message; } };
  r.readAsText(f);
}

// Ready
render();
</script>
</body>
</html>
